<style>
  .task-report-wrap {
    font-family: "Inter", "Helvetica Neue", Arial, sans-serif;
    font-size: 11px;
    color: #1f2937;
  }
  .task-report-header {
    margin-bottom: 14px;
    border-bottom: 1px solid #d1d5db;
    padding-bottom: 10px;
  }
  .task-report-title {
    margin: 0;
    font-size: 19px;
    font-weight: 700;
  }
  .task-report-meta {
    margin-top: 6px;
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
  }
  .task-filter {
    display: inline-block;
    margin-right: 12px;
  }
  .task-section {
    margin-top: 18px;
  }
  .task-section-title {
    margin: 0 0 8px 0;
    font-size: 14px;
    font-weight: 700;
  }
  .task-count {
    color: #6b7280;
    font-size: 12px;
    margin-left: 8px;
  }
  .task-table {
    width: 100%;
    border-collapse: collapse;
  }
  .task-table th,
  .task-table td {
    border: 1px solid #e5e7eb;
    padding: 6px;
    vertical-align: top;
    text-align: left;
  }
  .task-table th {
    background-color: #f9fafb;
    font-weight: 600;
  }
  .empty-row {
    color: #6b7280;
    font-style: italic;
  }
</style>

<div class="task-report-wrap">
  <div class="task-report-header">
    <h2 class="task-report-title">Daily Task Report</h2>
    <div class="task-report-meta">
      <div><strong>Report Date:</strong> {{ frappe.utils.formatdate(report_date) }}</div>
      <div><strong>Generated At:</strong> {{ frappe.utils.format_datetime(generated_on) }}</div>
      <div><strong>Generated By:</strong> {{ generated_by }}</div>
    </div>
    <div style="margin-top: 8px;">
      <span class="task-filter"><strong>User:</strong> {{ selected_user or "All" }}</span>
      <span class="task-filter"><strong>Project:</strong> {{ selected_project or "All" }}</span>
      <span class="task-filter"><strong>Priority:</strong> {{ selected_priority or "All" }}</span>
    </div>
  </div>

  {% for section_name in ["Upcoming (2 Days)", "Overdue", "Other Active Tasks"] %}
  <div class="task-section">
    <h3 class="task-section-title">
      {{ section_name }}
      <span class="task-count">({{ sections.get(section_name, [])|length }})</span>
    </h3>
    <table class="task-table">
      <thead>
        <tr>
          <th style="width: 12%;">Task</th>
          <th style="width: 25%;">Subject</th>
          <th style="width: 10%;">Project</th>
          <th style="width: 8%;">Status</th>
          <th style="width: 8%;">Priority</th>
          <th style="width: 8%;">Due Date</th>
          <th style="width: 8%;">Days To Due</th>
          <th style="width: 9%;">Previous Status</th>
          <th style="width: 12%;">Assignees</th>
        </tr>
      </thead>
      <tbody>
        {% if sections.get(section_name) %}
          {% for task in sections.get(section_name) %}
          <tr>
            <td>{{ task.name }}</td>
            <td>{{ task.subject or "" }}</td>
            <td>{{ task.project or "" }}</td>
            <td>{{ task.status or "" }}</td>
            <td>{{ task.priority or "" }}</td>
            <td>{{ frappe.utils.formatdate(task.due_date) if task.due_date else "" }}</td>
            <td>{{ task.days_to_due if task.days_to_due is not none else "" }}</td>
            <td>{{ task.previous_status or "" }}</td>
            <td>{{ task.assignees or "" }}</td>
          </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td class="empty-row" colspan="9">No tasks in this section.</td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
  {% endfor %}
</div>
